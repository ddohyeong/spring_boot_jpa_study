# MYSQL ì— ëŒ€í•œ ë°°ì¹˜ ì‚­ì œëŠ” JDBC URL í•„ìš”
```url

jdbc:mysql://localhost:3306/bookstoredb?cachePreStmts=true &useServerPrepStmts=true &rewriteBatchedStatements=true

```

## orphanRemoval=true ì‚¬ìš©
> ë¶€ëª¨ ì—”í‹°í‹°ì—ì„œ ë” ì´ìƒ ì°¸ì¡°ë˜ì§€ ì•ŠëŠ” ìì‹ ì—”í‹°í‹°ë¥¼ ì œê±°í•˜ë„ë¡ JPA ì˜ì†ì„± ê³µê¸‰ìì—ê²Œ ì§€ì‹œí•˜ê³ ì í™œì„±í™”

```java
@OneToMany(cascade = CascadeType.ALL, mappedBy = "author", orphanRemoval = true)
private List<Book> books = new ArrayList<>();
```

## deleteAllInBatch() ë‚´ì¥ ë©”ì„œë“œë¥¼ í†µí•œì‚­ì œ
> ëª¨ë“  ë ˆì½”ë“œë¥¼ ì‚­ì œí•˜ëŠ” ë§¤ìš° íš¨ìœ¨ì ì¸ ë°©ë²•

ğŸ“Œ í”ŒëŸ¬ì‹œë˜ì§€ ì•Šê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ ì—”í‹°í‹°ì— ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ í”¼í•˜ë ¤ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œí•˜ê³  í´ë¡œì§€ ë° í´ë¦¬ì–´ë¥¼ ì§ì ‘ ì²˜ë¦¬í•´ì•¼ í•œë‹¤. 


```java
@Transactional
public void deleteAuthorsAndBooksViaDeleteAllInBatch(){
	authorRepository.deleteAllInBatch(); 
}
```

```sql
delete from author;
```

## deleteInBatch (Iterable  t entities ) ë‚´ì¥ ë©”ì„œë“œë¥¼ í†µí•œ ì‚­ì œ
> ë°°ì¹˜ ì²˜ë¦¬ë‚˜ ì—…ë°ì´íŠ¸ ì†ì‹¤ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜ì€ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ 
> N + 1 ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŒ (ì—¬ëŸ¬ë²ˆ ì¿¼ë¦¬ë¥¼ -> í•œë²ˆì˜ ì¿¼ë¦¬ë¡œ )

```java
List<Author> authors = authorRepository.fetchAuthrosAndBooks(60);

authorRepository.deleteInBatch(authors);
```

```sql
DELETE FROM author WHERE id= ?
OR id = ? 
OR id = ? 
OR id = ? 
OR id = ? 
OR id = ?

```

## deleteAll() ë‚´ì¥ ë©”ì„œë“œë¥¼ í†µí•œ ì‚­ì œ

```java
@Transactional
public void deleteAuthorsAndBooksViaDeleteAl1() {
	Listâ€¹Authorâ€º authors = authorRepository.fetchAuthorsAndBooks(60);
	authorRepository.deleteAll(authors);
}
```

```java
@Transactional
public void deleteAuthorsAndBooksViaDeleteAllwithDelete() {
	List<Authorâ€º authors = authorRepository.fetchAuthorsAndBooks(60);
	authors.forEach(authorRepository::delete)
}
```
![200 \* 400](https://i.imgur.com/Rx9a3jG.png)
- ìµœì¢…ì ìœ¼ë¡œ ë°°ì¹˜ì²˜ë¦¬ê°€ ë¨ 
- ìµœì í™” ì§„í–‰ì€ ì§„í–‰ë˜ì§€ ì•ŠìŒ
- ë°°ì¹˜ ì²˜ë¦¬ëŠ” CascadeType.REMOVE ë¥¼ í¬í•¨í•˜ëŠ” CascadeType.ALL ë•Œë¬¸ì— ì‚¬ìš©ë˜ì§€ë§Œ managed ì—ì„œ removedë¡œ ê° ë„ì„œì˜ ìƒíƒœ ì „í™˜ì„ ë³´ì¥í•˜ê³ ì Book ë§ˆë‹¤ deleteë¬¸ì´ ì¡´ì¬

# SQL, ON DELETE CASCADE ì‚¬ìš©

- ë¶€ëª¨ í–‰ì´ ì‚­ì œë  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìì‹ í–‰ì„ ì‚­ì œí•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ìƒ ì²˜ë¦¬ì´ë©° í•˜ì´ë²„ë„¤ì´íŠ¸ @OnDeleteì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì§€ì‹œë¬¸ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. 

```java
@OnDelete(action = onDeleteAction.CASCADE)
```

```sql
ALTER TABLE book
ADD CONSTRAINT fkklnv3weler2ftkweewlky958 
FOREIGN KEY (author id) REFERENCES author (id) 
ON DELETE CASCADE

```

- ë‹¤ìŒê³¼ ê°™ì´ í…Œì´ë¸”ì´ ë³€ê²½ë¨
